# ПВЗ-система

## Запуск

1. Клонирование репозитория 

```git clone https://github.com/vvrl/pvz_system.git```

2. Запуск Docker-compose

```docker-compose up```

## Проблемы 

1. **Выбор драйвера PostgreSQL: pgx vs pq**  
На этапе проектирования стоял вопрос, какой драйвер использовать для подключения к базе данных PostgreSQL. Я выбрали pgx, так как он предлагает большую производительность, активную поддержку и более гибкие возможности по сравнению с pq. Также pgx лучше интегрируется с современными библиотеками миграций и connection pooling'а.

2. **Хранение конфигурации: yaml vs переменные окружения**  
Я рассматривал два подхода для конфигурации приложения — через yaml-файл или переменные окружения. В итоге остановился на переменных окружения, так как это более удобно для использования в контейнерах и в продакшн-средах (например, Kubernetes), а также упрощает CI/CD.

3. **Работа с JWT**  
Для авторизации пользователей требовалось изучить работу с JWT (JSON Web Tokens). Я реализовал генерацию и валидацию токенов, а также кастомные middleware для разграничения доступа по ролям (модератор, сотрудник и т.д.).

4. **Проблемы с Docker и Dockerfile**  
При запуске приложения через Docker возникли ошибки, связанные с некорректной инструкцией в Dockerfile. Проблему удалось решить после внимательного анализа логов и пересмотра слоев сборки.

5. **Goose и pgx**  
При использовании goose для миграций базы данных возникла проблема совместимости с pgx. goose ожидает интерфейс *sql.DB, в то время как pgx использует собственные типы. Я решил эту проблему, обернув pgx.Conn в stdlib адаптер, что позволило использовать pgx с goose без отказа от выбранного драйвера.
